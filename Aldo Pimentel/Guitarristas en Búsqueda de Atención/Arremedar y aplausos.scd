////////////////////////////// ARREMEDAR ////////////////////////////

~startRec = {
    var timestamp, path;
	timestamp = Date.getDate.format("%H%M_%S");
	path = "C:/Users/aldou/OneDrive/Escritorio/Amp/Burla/Arremedado%" + timestamp + ".wav";

    ~recorder = Recorder.new(s);
    ~recorder.recHeaderFormat = "wav";
    ~recorder.recSampleFormat = "int24";
    ~recorder.filePrefix = "Arremedado";
    ~recorder.record(path, ~busamp, 1);

    "‚úÖ Grabaci√≥n iniciada:".postln;
};


~stopRec = {
    if (~recorder.notNil and: { ~recorder.isRecording }) {
        ~recorder.stopRecording;
        "üõë Grabaci√≥n detenida".postln;
    } {
        "‚ö†Ô∏è No hay grabaci√≥n activa".postln;
    };
};

///////////////// AQU√ç PONER LA DIRECCI√ìN CORRECTA DE LA CARPETA "BURLA" ////////////////

~folder = "C:/Users/aldou/OneDrive/Escritorio/Amp/Burla";



SynthDef(\burlaPlayer, { |buf, out = 0, rate = 1, amp = 0.4|
    var sig;
    sig = PlayBuf.ar(1, buf, rate * BufRateScale.kr(buf), doneAction: 2);
    sig = sig * amp;
    Out.ar(out, sig);
}).add;

////////////////////////////// APLAUS√ìMETRO ////////////////////////////

SynthDef(\ataquesamp, {|in 2, umbral 0.5|
	var inp, onsets, chain, amp;
	inp = SoundIn.ar(in);
	amp  = Amplitude.kr(inp, 0.01, 1);
	SendReply.kr(Impulse.kr(10), '/aplauso', amp);
}).add;


~ampla = [];


OSCdef(\aplausometro, {|msg, time, addr, port|
	//msg[3].postln;
	~ampla = ~ampla.add(msg[3])
}, '/aplauso', s.addr);


~aplausometro = Routine({
	~apla = Synth(\ataquesamp);
	6.wait;
	~apla.free;
	~aplausos = ~ampla.sum/~ampla.size;
	~ampla = [];
	~aplausos.postln;
});